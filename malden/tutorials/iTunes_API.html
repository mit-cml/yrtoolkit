<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>malden</title>
  <link rel="stylesheet" href="../../css/scrollstyle.css">
  <link rel="stylesheet" href="../../css/style.css">
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="../../scripts/utils.js"></script>
  <script>
      $(window).bind('resize', function() {
          console.log("window resized")
      });
  </script>

  <script>
      $( function() {
          $( ".accordion" ).accordion({heightStyle: "content",activate: function( event, ui ) {
                  sendAnalyticsEvent( {
                      hitType: 'event',
                      eventCategory: 'Guide-' + document.getElementById("serverTutorialId").innerHTML,
                      eventAction: 'headerClick',
                      eventLabel: ui.newHeader.text()
                  });

              }});

          $( ".widget input[type=submit], .widget a, .widget button" ).button();
          //$( "button, input, a" ).click( );
      } );
  </script>

  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-31803258-2', 'auto');
      ga('send', 'pageview');

  </script>
</head>
<body>

<div style="width:100%;background-color:#8fc202;color:white;text-align:center;margin-bottom:5px;">
  <span style="font-size:14pt;font-weight:bold">Mobile App Guide</span>
</div>

<div id="maldenAccordion" class="accordion">

  <h3>Connect your App</h3>
  <div class="setup" id="connect_app"></div>

  <h3>iTunes API</h3>

  <div class="tutorialContainer">
    <div class="tutorialNavigationHeader"></div>

    <div class="tutorialContentPage">
      <h4>1. Introduction</h4>
      <p>
        In this tutorial you will use a Web API to get artist and music information from iTunes to display and play in your own app!
      </p>
      <p>
        Connect using the companion app so you can test this on your mobile device. If you don't know how to connect, click on the Connect your App tab above.</a>.
      </p>
    </div>

    <div class="tutorialContentPage">
      <h4>2. Make the layout</h4>
        <p>In the Designer, add the necessary components, so your Viewer looks like this:</p>
        <img class="enlargeImage" src="../images/iTunes_API/final_layout_look.png" alt="some_text">
        <p>&nbsp;</p>
        <div class="hintContainer">
        <button>Show Me How</button>
        <div class="hint hideHint">
          <p>From the User Interface drawer in the Palette window, drag an Image and a Label to the Viewer window.</p>
          <img class="enlargeImage" src="../images/iTunes_API/template1.png" alt="some_text">

        <p>Drag a Textbox from User Interface onto the Viewer.</p>
        <img class="enlargeImage" src="../images/iTunes_API/template2.png" alt="some_text">
        <p>Finally, add a button.</p>
        <img class="enlargeImage" src="../images/iTunes_API/template3.png" alt="some_text">
        <p>Add a horizontal arrangement below what you added before</p>
        <p>Horizontal arrangements allow you to place components horizontally.</p>
        <img class="enlargeImage" src="../images/iTunes_API/horizontal_arrangement.png" alt="some_text">
        <p>Drag two labels into the horizontal arrangement.</p>
        <img class="enlargeImage" src="../images/iTunes_API/labels.png" alt="some_text">
      </div>
    </div>
  </div>
    <div class="tutorialContentPage">
      <h4>3. Complete the layout</h4>
        <h4>Name all the components</h4>
        <p>It’s good practice to name your components descriptively so you can identify which component is which when coding.</p>

        <div class="hintContainer">
        <button>Show Me How</button>
          <div class="hint hideHint">
          <img class="enlargeImage" src="../images/iTunes_API/how_to_rename.png" alt="some_text">
            <p>Use the names below:</p>
          <img class="enlargeImage" src="../images/iTunes_API/rename.png" alt="some_text">
          </div>
        </div>

        <h4>Align the Layout</h4>
        <p>Change the <i>AlignHorizontal</i> property of both <strong>Screen1</strong> and <strong>ResponseArrangement</strong> to <span style="font-weight: bold; color: #0099ff;">"Center: 3"</span>. Change <strong>ResponseArrangement</strong>'s <i>Width</i> to <span style="font-weight: bold; color: #0099ff;">"Fill Parent"</span>. You can do this by selecting the component in the Components window and changing values in the Properties pane.</p>
        <div class="hintContainer">
        <button>Show Me How</button>
        <div class="hint hideHint">
          <img class="enlargeImage" src="../images/iTunes_API/center_3.png" alt="some_text">
          <img class="enlargeImage" src="../images/iTunes_API/fill_parent.png" alt="some_text">
        </div>
        </div>
        <h4>A few more adjustments</h4>
        <p>Change the <i>Picture</i> for <strong>IconImage</strong> to <span style="font-weight: bold; color: #0099ff;">itunes-icon.png</span> (it should be preloaded in the template)</p>
        <p>For <strong>ArtistTextBox</strong>, change its <i>Width</i> to <span style="font-weight: bold; color: #0099ff;">75%</span> and its <i>Hint</i> to <span style="font-weight: bold; color: #0099ff;">"Enter artist's name here"</span>.</p>
        <div class="hintContainer">
        <button>Show Me How</button>
        <div class="hint hideHint">
          <img class="enlargeImage" src="../images/iTunes_API/icon_image.png" alt="some_text">
          <img class="enlargeImage" src="../images/iTunes_API/width_hint.png" alt="some_text">
        </div>
        </div>
       <p>And finally, update the Text properties for your Labels and Button.</p>
       <p>Once again, your final layout should look like this:</p>
        <img class="enlargeImage" src="../images/iTunes_API/final_layout_look.png" alt="some_text">

  </div>

  <div class="tutorialContentPage">
    <h4>4. Add a Web component and a Player component</h4>
      <p>These will show up below the Viewer, since they are hidden components.</p>
      <div class="hintContainer">
        <button>Show Me How</button>
        <div class="hint hideHint">
        <img class="enlargeImage" src="../images/iTunes_API/web.png" alt="some_text">
        <img class="enlargeImage" src="../images/iTunes_API/player.png" alt="some_text">
      </div>
      </div>
    </div>





   <div class="tutorialContentPage">
    <h4>5. Start coding</h4>
    <p>Switch to the Blocks Editor.</p>
    <img class="enlargeImage" src="../images/iTunes_API/switch-blocks.png" alt="some_text">
  </div>
  <div class="tutorialContentPage">
    <h4>6. Make a Procedure to Query iTunes</h4>
    <p>The first thing you'll do is make a procedure.</p><p>A procedure is a way to take a set of blocks and give them a name, so they can be used in multiple places, by “calling” the procedure.</p>
    <p>Make a new procedure called "queryiTunes".</p>
     <div class="hintContainer">
      <button>Show Me How</button>
      <div class="hint hideHint">
        <p>Drag a <span class="procedures">to procedure</span> block out. Rename it "queryiTunes".</p>
        <img class="enlargeImage" src="../images/iTunes_API/query_itunes.png" alt="some_text">
      </div>
    </div>
    <p>Add an input parameter to the procedure.</p>
      <div class="hintContainer">
      <button>Show Me How</button>
      <div class="hint hideHint">
        <p>Click on the blue mutator button to add an input parameter to your procedure. Replace the "x" with "artistName".</p>
        <img class="enlargeImage" src="../images/iTunes_API/input_parameter.png" alt="some_text">
      </div>
      </div>
    <p>Set the Web component's URL to the the iTunes API call.</p>
    <div class="hintContainer">
      <button>Show Me How</button>
      <div class="hint hideHint">
        <p>Select the Web component. Drag out a <span class="setters">set Web1.Url to</span> block and snap it into your procedure.</p>
        <img class="enlargeImage" src="../images/iTunes_API/web1_url.png" alt="some_text">
        <p>Drag out a <span class="text">join</span> block. The join block joins multiple text blocks so they are a single text string. You'll need to join three text blocks, so add a third input slot. You do this by clicking on the little blue gear icon and dragging another string block into the join block in the popup window.</p>
        <img class="enlargeImage" src="../images/iTunes_API/joining1.png" alt="some_text">

        <p>Add the following text strings into the first and third slots:</p>
        <p><span class="text">https://itunes.apple.com/search?term=</span></p>
        <p><span class="text">&limit=1</span></p>
        <img class="enlargeImage" src="../images/iTunes_API/joining2.png" alt="some_text">
        <p>Add <span class="variables">get artistName</span> in the middle slot.</p>
        <img class="enlargeImage" src="../images/iTunes_API/joining3.png" alt="some_text">
        <p>Your blocks should now look like the following:</p>
        <img class="enlargeImage" src="../images/iTunes_API/final_joining.png" alt="some_text">
        <p>Finally, drag a <span class="procedures">call Web1.Get</span> block to the end of the procedure.</p>
        <img class="enlargeImage" src="../images/iTunes_API/web1_get.png" alt="some_text">
      </div>
    </div>
   </div>

   <div class="tutorialContentPage">
     <h4>7. Code the QueryButton</h4>
      <p>Code the QueryButton so when a user clicks the button, it: 
        <ul><li>resets the IconImage picture to the iTunes icon image</li>
          <li>calls the <strong>queryiTunes</strong> procedure to get the artist information based on what is typed in the ArtistTextbox</li>
        </ul>
      </p>
      <div class="hintContainer">
      <button>Show Me How</button>
      <div class="hint hideHint">

        <p>Drag out a <span class="control">when QueryButton.Click</span> block.</p>
        <img class="enlargeImage" src="../images/iTunes_API/query_button_click.png" alt="some_text">
        <p>Reset the IconImage.Picture to the iTunes icon image (itunes-icon.jpg). This is in case it has been set to something different during a previous query.</p>
        <img class="enlargeImage" src="../images/iTunes_API/icon_image_picture.png" alt="some_text">
        <p>Then, call the <span class="procedures">queryiTunes</span> procedure.</p>
        <img class="enlargeImage" src="../images/iTunes_API/call_query_itunes.png" alt="some_text">
        <p>The input to <span class="procedures">queryiTunes</span> will be the contents of ArtistTextbox. You can’t have any spaces in the query, so drag out a <span class="text">replace all text</span> block and a <span class="text">trim</span> block from the Text drawer.</p>The <span class="text">trim</span> block removes any spaces at the front or end of the text box. Then <span class="text">replace all text</span> will replace all spaces between names with a plus sign “<span class="text">+</span>”. 

        <img class="enlargeImage" src="../images/iTunes_API/artist_textbox_mod.png" alt="some_text">
        <p>Make sure you use a space, not a blank, for the segment slot!</p>
    </div>
    </div>
  </div>

   <div class="tutorialContentPage">
     <h4>8. How to Decode the Response from the Web API in App Inventor</h4>
     <p>When you make a Web API request with the <span class="procedures">Web1.Get</span> block, it waits until a response is received, and it triggers the <span class="control">Web1.GotText</span> event. Here is an example of a response, which may look confusing:</p>
     <img class="enlargeImage" src="../images/iTunes_API/example_response.png" alt="some_text">
     <p>Once you understand what information is there, you realize it's a pretty powerful tool.</p>
     <p>App Inventor provides a block, <span class="procedures">Web1.JsonTextDecode</span>, that puts this text into a series of lists, so that you can extract the pieces you want by using <span class="lists">select list item</span>. In the text above, think of the brackets “{“ and “[“ as the start of a new list. And each comma is a separator between list items.</p>
     <p>The large text block above that starts with “wrapperType” is another kind of list organizer, called key/value pairs. For example, "wrapperType" is the key, and "track" is the value.</p>
      <p>Here is the same text block from above with items indented and highlighted to make it easier to see what information is there.</p>
    <img class="enlargeImage" src="../images/iTunes_API/example_response2.png" alt="text response highlighted">
     <p>The yellow highlighted text are the keys, and the green highlighted text are the values that go with the keys. See, for example, that "artistName" is the key, and "Bruno Mars" is the value.</p> 
   </div>

   <div class="tutorialContentPage">
     <h4>9. Decode the Web response</h4>
      <div class="hintContainer">
      <button>Show Me How</button>
      <div class="hint hideHint">
        <p>Drag out a <span class="control">Web1.GotText</span> block.</p>
        <p>When you make a Web API request with the <span class="procedures">Web1.Get</span> block, the apps waits until a response is received, and then the app triggers the <span class="control">Web1.GotText</span> event. </p>
        <img class="enlargeImage" src="../images/iTunes_API/web1_text.png" alt="some_text">
        <p>You need to strip out the extraneous text in that long response text to get to the key/value pairs. There are a few steps needed, so it's helpful to store the text in a variable.</p>
        <p>Variables are a way to store information by giving it a name, and referencing the name in your code. You can also change the value of a variable if you need to. You will do that as you strip away the extra text to get to the key/value pairs.</p>
      <p>Make a local variable. Drag out the block from the Variables drawer, then click on the default <span class="variables">name</span> and change it to <span class="variables">responsePairs</span>. <em>Local</em> means it’s only being used within the event block.</p>
      <img class="enlargeImage" src="../images/iTunes_API/response_pairs.png" alt="some_text">
      <p>Drag out a <span class="procedures">JsonTextDecode</span> block from the Web1 drawer to put the long text response into lists.</p>
      <img class="enlargeImage" src="../images/iTunes_API/json_decode.png" alt="some_text">
      <p>You’ll need three <span class="lists">select list item</span> blocks, to get to the inner pair lists.</p>
      <img class="enlargeImage" src="../images/iTunes_API/list_items.png" alt="some_text">
      <p>Put it all together, using the appropriate indices (2, 2, and 1) which you can get from dragging a 0 from the Math drawer and changing the number. Note that blocks are executed from right to left here, with <span class="procedures">Web1.JsonTextDecode</span> executed first, then each <span class="lists">select list item</span>.</p>
     <img class="enlargeImage" src="../images/iTunes_API/list_decode.png" alt="some_text">
     <p>So, you are selecting the 2nd item in the responseText, which is itself a list. From that you again select the 2nd item, another list. From that, you select the 1st item, another list that is made up of the response pairs.</p>
     <p>After connecting all the blocks, you should have something like this:</p>
     <img class="enlargeImage" src="../images/iTunes_API/list_decode_complete.png" alt="some_text">
    </div>
    </div>
    </div>

   <div class="tutorialContentPage">
     <h4>10. Extract the URL for the song</h4>
     <p>The Player component plays music files. The goal is to extract a URL that points to the artist's song from the responsePairs. Once you have that, you'll tell the Player component that is the song you want to play.</p>
      <div class="hintContainer">
      <button>Show Me How</button>
      <div class="hint hideHint"> 
          <p>Drag out a <span class="setters">set Player1.Source</span> block.</p>
          <img class="enlargeImage" src="../images/iTunes_API/player1_source_set.png" alt="some_text">
          <p>App Inventor supplies a block called <span class="lists">look up in pairs</span> that you can use to extract specific information using the key, once you’ve stripped out all the extra information at the beginning of the text string.</p>
          <p> The key you’re looking for is “previewUrl”. </p>
        <img class="enlargeImage" src="../images/iTunes_API/previewUrl.png" alt="shows previewURL key value pair">
            <p><p>Drag out a <span class="lists">look up in pairs</span> block from the Lists drawer and snap it in. You’ll extract this from the <span class="variables">responsePairs</span> variable.</p>
        <img class="enlargeImage" src="../images/iTunes_API/look_up_in_pairs.png" alt="some_text">
        <p>Drag out a <span class="procedures">Player1.Start</span> block and snap it in below.</p>
        <p>Finally, reset <span class="setters">set ArtistTextBox.Text</span> to a blank string for the next search.</p>
        <img class="enlargeImage" src="../images/iTunes_API/player1_start.png" alt="some_text">
    </div>
    </div>
  </div>

   <div class="tutorialContentPage">
     <h4>11. Set the ArtistLabel and SongLabel</h4>
     <p>Here is a challenge for you. Can you add code to set ArtistLabel.Text and SongLabel.Text by using the <span class="lists">look up in pairs</span> block?</p>
     <p>For the keys, you will use the ones designated by the red arrows below.</p>
      <img class="enlargeImage" src="../images/iTunes_API/keys.png" alt="some_text">
      <p>&nbsp;</p>
      <div class="hintContainer">
      <button>Show Me How</button>
      <div class="hint hideHint"> 
        <p>You need to follow the same format as the <span class="setters">set Player1.Source</span> block.</p>
        <p>Drag out blocks to set the Text for ArtistLabel and SongLabel.</p>
        <p>And duplicate the <span class="lists">look up in pairs</span> block from above. Twice.</p>
        <p>Change “previewUrl” to “artistName” for ArtistLabel, and to “trackName” for SongLabel. Get the spelling exactly as shown.</p>
        <p>Snap in both below <span class="setters">set Player1.Source</span>.</p>
        <img class="enlargeImage" src="../images/iTunes_API/challenge_help.png" alt="some_text">
      </div>
      </div>
   </div>

   <div class="tutorialContentPage">
     <h4>12. Test it out!</h4>
     <p>Test your app out using the MIT AI2 Companion! Type in the name of your favorite musical artist, submit, and listen!</p>
      <img class="enlargeImage" src="../images/iTunes_API/test_it.png" alt="some_text">
     <p> Now that you're done, please fill out the <a href="http://bit.ly/iTunesAPICheckIn">Post Tutorial Check-In</a>.</p>
   </div>

  <br/>
  <div class="tutorialNextButtonContainer" style="width:100%;text-align:center;">
    <button type="button" class="btn btn-success btn-lg tutorialNextButton" style="font-size:24pt;">Next Step</button>
  </div>
  </div>

<h3> Challenge</h3>
<div class="tutorialContainer">
  <div class="tutorialNavigationHeader"></div>
    <div class="tutorialContentPage">
      <h4>Extend your app!</h4>
      <img class="enlargeImage" src="../images/iTunes_API/extend_app.png" alt="some_text">
      <p>Go to the next page for help with these extensions.</p>
    </div>

    <div class="tutorialContentPage">
      <h4>Stop Playing Music</h4>
      <p>You'll need to add a new Button for stopping the music. </p>
      <p>When the user submits their artist information and iTunes returns the information, the music plays.</p>
      <img class="enlargeImage" src="../images/iTunes_API/challenge1_1.png" alt="some_text">
      <p>Look in the Player1 drawer to see what other blocks are available. Can you find a block to stop the music?</p>
    </div>

    <div class="tutorialContentPage">
      <h4>Play Alternate Song</h4>
      <p>Remember, we limited the response from iTunes to 1 song.</p>
      <img class="enlargeImage" src="../images/iTunes_API/challenge1_2.png" alt="some_text">
      <p>So, if you change 1 to 2, chances are you’ll get information for 2 songs by the artist.</p>
      <p>From the response, if you want to choose the second song, select the second item in the list.</p>
      <img class="enlargeImage" src="../images/iTunes_API/challenge1_3.png" alt="some_text">
      <p>Think about how you want to play the song. Randomly select the first or the second? Add another button to play the second song?</p>
    </div>

    <div class="tutorialContentPage">
      <h4>Displaying Other Artist Information</h4>
      <p>Recall that the response from iTunes includes many key/value pairs. Look through the text that iTunes returns from the Web API to see what other key/pair values you could extract.</p>      <img class="enlargeImage" src="../images/iTunes_API/example_response2.png" alt="key value pairs shown">
      <p>Use <span class="lists">look up in pairs</span> in  <span class="control">Web1.GotText</span> to pull out other information. For example, you could extract the album/CD cover image using the key "artworkUrl100".</p>
      <img class="enlargeImage" src="../images/iTunes_API/challenge2_1.png" alt="key value pairs shown">
      <img class="enlargeImage" src="../images/iTunes_API/challenge2_2.png" alt="some_text">
      <p>Consider what information you are extracting. The artwork would have to go in an Image component (set Picture to). If it’s text information, it would go in a Label (set Text to).</p>
    </div>

    <br/>
    <div class="tutorialNextButtonContainer" style="width:100%;text-align:center;">
    <button type="button" class="btn btn-success btn-lg tutorialNextButton" style="font-size:24pt;">Next Step</button>
    </div>
  </div>
</div>


</div>

<div id="serverTutorialId" style="display:none;">2</div>
<div id="hasAnalytics" style="display:none;">1</div>
</body>
<script src="../../scripts/tabHandler.js"></script>
<script src="../../scripts/tutorialPage.js"></script>
<script src="../../scripts/shareAndPublish.js"></script>

</html>
